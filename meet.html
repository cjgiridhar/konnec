<!DOCTYPE html>
<html>
    
    <head>
		<meta charset="utf-8">
  		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  		<title>konnec.io</title>
  		<meta name="description" content="">
  		<meta name="viewport" content="width=device-width">

		<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
		<script>
    
    	;(function($) {

         // DOM Ready
        $(function() {

            // Binding a click event
            // From jQuery v.1.7.0 use .on() instead of .bind()
            $('#c2a-toggle').on('click', function(e) {

                // Prevents the default action to be triggered.
                e.preventDefault();

                // Triggering bPopup when click event is fired
                $('#element_to_pop_up').bPopup({
					speed: 450,
            		transition: 'slideIn',
            		modalClose: false,
            		opacity: 0.6,
            		positionStyle: 'fixed' //'fixed' or 'absolute'
                });

            });

          });

    	})(jQuery);
 

 
    ;(function($) {

         // DOM Ready
        $(function() {

            // Binding a click event
            // From jQuery v.1.7.0 use .on() instead of .bind()
            $('#chat-toggle').on('click', function(e) {

                // Prevents the default action to be triggered.
                e.preventDefault();

                // Triggering bPopup when click event is fired
                $('#element_to_pop_up_chat').bPopup();

            });

        });

    })(jQuery);
    
     ;(function($) {

         // DOM Ready
        $(function() {

            // Binding a click event
            // From jQuery v.1.7.0 use .on() instead of .bind()
            $('#code-toggle').on('click', function(e) {

                // Prevents the default action to be triggered.
                e.preventDefault();

                // Triggering bPopup when click event is fired
                $('#element_to_pop_up_code').bPopup();

            });

        });

    })(jQuery);   
    
 </script>
 
 		<script src="webrtc/page/js/jquery.bpopup.min.js"></script>
		<!--script src="http://code.jquery.com/jquery-1.10.0.min.js"></script-->
  		<link rel="stylesheet" href="webrtc/page/css/normalize.min.css">
  		<link rel="stylesheet" href="webrtc/page/css/main.css">
  		<script src="webrtc/page/js/vendor/modernizr-2.6.2.min.js"></script>

  		<script>
    		var room = "#{ params.room }";
    		var initCall = "#{ room_count > 0 }";
  		</script>



    </head>

    <body>
    <div id="remotes"></div>
    <div id="main-video" class="mainvideo"></div>
	
    <div id="viewport">
    	
		<!--div id='controls'></div-->
    	<header id="ice-header">
      		<!--a id="hdr-toggle" href="#hdr"></a-->
      			
      		<!--div class="circles action top">
        		<a href="#call-phone" class="call-phone"></a>
        		<a href="#share-screen" class="share-screen"></a>
        		<a href="#web-cam" class="web-cam"></a>
        		<a href="#share-folder" class="share-folder"></a>
      		</div-->
     	</header>

		        
      	<section id="main">	
      		
      		<!--video id="main-video"></video>
			<div id='controls'></div>
        	<div id="remotes"></div-->
      		
      		<div id="menu" class="circles action main">
      			
        		<a id="localmute" class="mic"></a>
        		<a id="localunmute" class="micmute"></a>
        		<a id="web-cam" class="web-cam"></a>
        		<a id="web-camstop" class="web-camstop"></a>
        		<!--a href="#tag" class="tag"></a-->
        		<!-- a href="#record" class="record"></a -->
        		
        		<a id="screenShareStop"  class="share-screenstop" ></a>
        		<a id="screenShare"  class="share-screen" ></a>
        		<a id="connect" class="call-phone"></a>
        		<a id="disconnect" class="disconnect"></a>
        		<!--a id="invite" class="invite"></a-->
        		<!--a href="#share-folder" class="share-folder"></a-->
      		</div>
			
      		<video id="overlay-video"></video>
			
			<!--a href="#x" class="overlay" id="popup_form"></a>
			<div class="popup">
			<iframe src="http://google.com" name="google" width="100%" height="300"> </iframe>
			<a class="close" href="#close"></a>
			</div-->
			
      		<div class="c2a">
        		<button id="c2a-toggle"></button>
			</div>
			<div class="c2a">	
				<button id="chat-toggle"></button>
			</div>
			<div class="c2a">	
				<button id="code-toggle"></button>
			</div>
							
			<div id="element_to_pop_up" style="display:none; width:800px; height:500px">
			<iframe src="https://hidden-tundra-8572.herokuapp.com/board/index.html" width="100%" height="500"> </iframe>
    		<a class="b-close">x</a>
			</div>

			<div id="element_to_pop_up_chat" style="display:none; width:800px; height:500px">
			<iframe src="https://hidden-tundra-8572.herokuapp.com/chats/" width="100%" height="500"> </iframe>
    		<a class="b-close">x</a>
			</div>
			
			<div id="element_to_pop_up_code" style="display:none; width:800px; height:500px">
			<iframe src="https://localhost:13337/" width="100%" height="500"> </iframe>
    		<a class="b-close">x</a>
			</div>			
			
       	</section>

	</div>   <!-- end of viewport -->

    	
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
  	<script>window.jQuery || document.write('<script src="webrtc/page/js/vendor/jquery-1.10.1.min.js"><\/script>')</script>

    <!--h1 id="title">Start a room</h1-->
    <style>
            /*#main-video video {
                height: 150px;
            }*/

            #main-video video {
            	height: 200px;
            	width: 250px;
   				border: 2px solid white;
   				
            }
            	
    </style>
        
        <!--p id="subTitle"></p>
        <form id="createRoom">
            <input id="sessionInput"/>
            <button type="submit">Create it!</button>
        </form-->

    <!--video id="main-video"></video-->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <script src="webrtc/socket.io.js"></script>
    <script src="webrtc/simplewebrtc.bundle.js"></script>
    <script>
        	$('#localunmute').hide();
        	$("#screenShareStop").hide();
        	$('#connect').hide();
        	$('#web-camstop').hide();
            // grab the room from the URL
            var room = location.search && location.search.split('?')[1];

            // create our webrtc connection
            var webrtc = new SimpleWebRTC({
                // the id/element dom element that will hold "our" video
                localVideoEl: 'main-video',
                // the id/element dom element that will hold remote videos
                remoteVideosEl: 'remotes',
                // immediately ask for camera access
                autoRequestMedia: true,
                debug: true,
                detectSpeakingEvents: true,
                autoAdjustMic: false
            });

            // when it's ready, join if we got a room from the URL
            webrtc.on('readyToCall', function () {
                // you can name it anything
                if (room) webrtc.joinRoom(room);
            });
            
            // Since we use this twice we put it here
            function setRoom(name) {
                $('form').remove();
                //$('h1').text(name);
                //$('#subTitle').text('Link to join: ' + location.href);
                $('body').addClass('active');
            }

            if (room) {
                setRoom(room);
            } else {
                $('form').submit(function () {
                    var val = $('#sessionInput').val().toLowerCase().replace(/\s/g, '-').replace(/[^A-Za-z0-9_\-]/g, '');
                    webrtc.createRoom(val, function (err, name) {
                        console.log(' create room cb', arguments);
                    
                        var newUrl = location.pathname + '?' + name;
                        if (!err) {
                            history.replaceState({foo: 'bar'}, null, newUrl);
                            setRoom(name);
                        } else {
                            console.log(err);
                        }
                    });
                    return false;          
                });
            }


            /*var button = $('#screenShareButton'),
                setButton = function (bool) {
                    button.text(bool ? 'share screen' : 'stop sharing');
                };

            setButton(true);

            button.click(function () {
                if (webrtc.getLocalScreen()) {
                    webrtc.stopScreenShare();
                    setButton(true);
                } else {
                    webrtc.shareScreen(function (err) {
                        if (err) {
                            setButton(true);
                        } else {
                            setButton(false);
                        }
                    });
                    
                }
            });

            var endbutton = $('#endCall'),
                setEndButton = function (bool) {
                    endbutton.text(bool ? 'stay' : 'leave');
                };

            setEndButton(false);

            endbutton.click(function () {
                alert("Clicked on leave meeting");
				webrtc.stopScreenShare();
				webrtc.leaveRoom();
				$('#main-video').remove();
				alert("Left room");
            }); */

			$("#disconnect").on("click", function () {
                //alert("Clicked on leave meeting");
				webrtc.stopScreenShare();
				webrtc.leaveRoom();
				$('#main-video').hide();
				$("#disconnect").hide();
				$('#connect').show();
            });

			$("#connect").on("click", function () {
                //alert("Clicked on leave meeting");
				//webrtc.stopScreenShare();
				//webrtc.leaveRoom();
				$('#main-video').show();
				$("#disconnect").show();
				$("#connect").hide();	
            });

			$("#screenShare").on("click", function() {
				//alert("Sharing your screen");
				webrtc.shareScreen();
				$("#screenShare").hide();
				$("#screenShareStop").show();
			});	
			
			$("#screenShareStop").on("click", function() {
				//alert("Sharing your screen");
				webrtc.stopScreenShare();
				$("#screenShareStop").hide();
				$("#screenShare").show();
			});				
				
			$("#localmute").on("click", function() {
				//alert("muting");
				webrtc.mute();
				$("#localmute").hide();
				//$('#menu').append('<a id="localunmute" class="micmute"></a>')
				$('#localunmute').show();
				//$('#main-video').remove();
				//$('#localmuteimage').add();
			});	
	
			$("#localunmute").on("click", function() {
				//alert("unmuting");
				//$('#main').append('<video id="main-video"></video>');
				//$('#main-video').add();
				webrtc.unmute();
				$('#localunmute').hide();
				$("#localmute").show();
				//$('#localmuteimage').add();
			});	
			
			$("#web-cam").on("click", function() {
				//alert("muting");
				webrtc.pause();
				$("#web-cam").hide();
				//$('#menu').append('<a id="localunmute" class="micmute"></a>')
				$('#web-camstop').show();
				//$('#main-video').remove();
				//$('#localmuteimage').add();
			});	
	
			$("#web-camstop").on("click", function() {
				//alert("unmuting");
				//$('#main').append('<video id="main-video"></video>');
				//$('#main-video').add();
				webrtc.resume();
				$('#web-camstop').hide();
				$("#web-cam").show();
				//$('#localmuteimage').add();
			});

    </script>
    </body>
    
    <style type="text/css">
 	#element_to_pop_up {
    background-color:#fff;
    border-radius:15px;
    color:#000;
    display:none;
    padding:20px;
    min-width:400px;
    min-height: 180px;
	}
    .b-close{
    cursor:pointer;
    position:absolute;
    right:10px;
    top:5px;
	}

        #element_to_pop_up_chat {
    background-color:#fff;
    border-radius:15px;
    color:#000;
    display:none;
    padding:20px;
    min-width:400px;
    min-height: 180px;
        }
    .b-close-chat{
    cursor:pointer;
    position:absolute;
    right:10px;
    top:5px;
        }
        #element_to_pop_up_code {
    background-color:#fff;
    border-radius:15px;
    color:#000;
    display:none;
    padding:20px;
    min-width:400px;
    min-height: 180px;
        }
    .b-close-code{
    cursor:pointer;
    position:absolute;
    right:10px;
    top:5px;
        }

	</style>
</html>
